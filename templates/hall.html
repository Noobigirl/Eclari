<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Eclari ‚Äî Hall Head Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
  
  <!-- Favicon -->
  <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
  <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='images/favicon_io/favicon-32x32.png') }}">
  <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='images/favicon_io/favicon-16x16.png') }}">
  <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='images/favicon_io/apple-touch-icon.png') }}">
  <link rel="manifest" href="{{ url_for('static', filename='images/favicon_io/site.webmanifest') }}">
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <a class="brand" href="{{ url_for('home') }}">
        <img class="brand-mark" src="{{ url_for('static', filename='images/favicon_io/favicon-32x32.png') }}" alt="Eclari Logo">
        <span class="brand-text">Eclari</span>
      </a>
      <nav class="nav">
        <span class="chip">Hall Head</span>
        <a class="button" href="{{ url_for('login') }}">Sign out</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <!-- Header Section -->
    <div class="dashboard-header animate-fadeInUp">
      <div>
        <h1 style="margin:0; font-size: 2rem; font-weight: 700; color: var(--ala-gold);">
          {{ hall_name }} Hall Management
        </h1>
        <p style="margin: 8px 0 0; color: var(--muted); font-size: 1.1rem;">
          Managing {{ hall_students|length }} students ‚Ä¢ Hall Head: {{ user.first_name }} {{ user.last_name }}
        </p>
      </div>
      
      <!-- Search and Filters -->
      <div class="hall-controls">
        <div class="search-container">
          <input id="hallSearch" class="input search-input" placeholder="üîç Search students, rooms, or year groups..." 
                 style="min-width: 320px; font-size: 15px;">
        </div>
        <div class="filter-controls">
          <div class="select-wrap" style="min-width: 150px;">
            <select id="yearGroupFilter" class="select-hidden">
              <option value="">All Year Groups</option>
              <option value="Y1">Year 1</option>
              <option value="Y2">Year 2</option>
            </select>
            <button type="button" class="select-trigger" id="yearGroupTrigger">
              <span id="yearGroupText">All Year Groups</span>
              <span class="select-caret"></span>
            </button>
            <div class="select-menu" id="yearGroupMenu">
              <div class="select-option" data-value="" aria-selected="true">All Year Groups</div>
              <div class="select-option" data-value="Y1">Year 1</div>
              <div class="select-option" data-value="Y2">Year 2</div>
            </div>
          </div>
          
          <div class="select-wrap" style="min-width: 150px;">
            <select id="statusFilter" class="select-hidden">
              <option value="">All Statuses</option>
              <option value="approved">Cleared</option>
              <option value="pending">Pending</option>
              <option value="not-started">Not Started</option>
            </select>
            <button type="button" class="select-trigger" id="statusTrigger">
              <span id="statusText">All Statuses</span>
              <span class="select-caret"></span>
            </button>
            <div class="select-menu" id="statusMenu">
              <div class="select-option" data-value="" aria-selected="true">All Statuses</div>
              <div class="select-option" data-value="approved">Cleared</div>
              <div class="select-option" data-value="pending">Pending</div>
              <div class="select-option" data-value="not-started">Not Started</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Statistics Cards -->
    <div class="hall-stats animate-fadeInUp stagger-1">
      <div class="stat-card">
        <div class="stat-number">{{ hall_students|length }}</div>
        <div class="stat-label">Total Residents</div>
      </div>
      <div class="stat-card stat-success">
        <div class="stat-number">
          {{ hall_students|selectattr('hall_clearance_status', 'equalto', 'approved')|list|length }}
        </div>
        <div class="stat-label">Hall Approved</div>
      </div>
      <div class="stat-card stat-warning">
        <div class="stat-number">
          {{ hall_students|selectattr('room_status', 'equalto', 'needs_attention')|list|length }}
        </div>
        <div class="stat-label">Need Attention</div>
      </div>
      <div class="stat-card stat-neutral">
        <div class="stat-number">
          {{ hall_students|selectattr('room_status', 'equalto', 'clean')|list|length }}
        </div>
        <div class="stat-label">Rooms Ready</div>
      </div>
    </div>

    <!-- Students Table -->
    <div class="card glass animate-fadeInUp stagger-2" style="padding: 0; overflow: hidden;">
      <div class="table-header">
        <h3 style="margin: 0; padding: 24px 24px 0; font-size: 1.4rem; font-weight: 600;">Student Clearance Status</h3>
        <div class="table-actions" style="padding: 0 24px 16px;">
          <span class="table-count">Showing <span id="visibleCount">{{ hall_students|length }}</span> of {{ hall_students|length }} students</span>
        </div>
      </div>
      
      <div class="table-container">
        <table class="table modern-table" id="hallTable">
          <thead>
            <tr>
              <th>Student</th>
              <th>Year Group</th>
              <th>Room</th>
              <th>Room Status</th>
              <th>Hall Clearance</th>
            </tr>
          </thead>
          <tbody>
            {% for student in hall_students %}
            <tr class="table-row" data-student-name="{{ student.first_name }} {{ student.last_name }}" 
                data-room="{{ student.room_number }}" data-year-group="{% if student.year_group %}Y{{ student.year_group }}{% endif %}" 
                data-status="{{ student.hall_clearance_status or 'pending' }}">
              <td class="student-cell">
                <div class="student-info">
                  <div class="student-avatar">{{ student.first_name[0] }}{{ student.last_name[0] }}</div>
                  <div>
                    <div class="student-name">{{ student.first_name }} {{ student.last_name }}</div>
                    <div class="student-id">{{ student.student_id }}</div>
                  </div>
                </div>
              </td>
              <td>
                <span class="year-badge">
                  {% if student.year_group %}
                    Y{{ student.year_group }}
                  {% else %}
                    N/A
                  {% endif %}
                </span>
              </td>
              <td>
                <span class="room-number">{{ student.room_number or 'N/A' }}</span>
              </td>
              <td>
                <span class="badge 
                  {% if student.room_status == 'clean' %}badge-success
                  {% elif student.room_status == 'needs_attention' %}badge-warning
                  {% else %}badge-neutral{% endif %}">
                  {% if student.room_status == 'clean' %}Clean & Ready
                  {% elif student.room_status == 'needs_attention' %}Needs Attention
                  {% else %}Pending Inspection{% endif %}
                </span>
              </td>
              <td class="hall-action-cell">
                <div class="hall-clearance-buttons">
                  <button class="button button-sm {% if student.hall_clearance_status == 'approved' %}button-success{% else %}button-outline{% endif %}" 
                          onclick="updateHallClearance('{{ student.student_id }}', 'approved')">
                    ‚úì Approve
                  </button>
                  <button class="button button-sm {% if student.hall_clearance_status == 'rejected' %}button-error{% else %}button-outline{% endif %}" 
                          onclick="updateHallClearance('{{ student.student_id }}', 'rejected')">
                    ‚úó Reject
                  </button>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      
      {% if not hall_students %}
      <div class="empty-state">
        <div class="empty-icon">üè†</div>
        <h3>No Students Found</h3>
        <p>No students are currently assigned to rooms in this hall.</p>
      </div>
      {% endif %}
    </div>
  </main>

  <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>


