import{s as I,g as U,a as Y,c as W,o as q}from"./auth.bundle.js";(function(){const e=n=>document.querySelector(n),h=e("#role"),v=e("#roleTrigger"),T=e("#roleTriggerText"),S=e("#roleMenu"),C=e("#roleSelectWrap"),L=e("#loginSubtitle"),y=document.querySelector(".auth-visual"),$={student:{subtitle:"African Leadership Academy • Student Clearance Portal",bg:"url('/static/images/students.jpeg')"},teacher:{subtitle:"African Leadership Academy • Teacher Clearance Dashboard",bg:"url('/static/images/teacher.jpeg')"},finance:{subtitle:"African Leadership Academy • Finance Clearance Dashboard",bg:"url('/static/images/finance.jpeg')"},hall:{subtitle:"African Leadership Academy • Hall Clearance Dashboard",bg:"url('/static/images/hall.jpeg')"},coach:{subtitle:"African Leadership Academy • Sports Clearance Dashboard",bg:"url('/static/images/coach.jpeg')"},lab:{subtitle:"African Leadership Academy • Labs Clearance Dashboard",bg:"url('/static/images/lab.jpeg')"}};let E=null;function F(n,a){const t=new Image;t.onload=a,t.src=n.replace(/^url\(['"]?|['"]?\)$/g,"").replace(/^url\('/,"").replace(/'\)$/,"")}function j(n){const a=$[n]||$.student;y&&(E&&(clearTimeout(E),E=null),L&&(L.style.opacity="0",setTimeout(()=>{L.textContent=a.subtitle,L.style.opacity="1"},120)),F(a.bg.replace(/^url\(|\)$/g,"").replace(/['"]/g,""),()=>{y.style.setProperty("--auth-visual-bg-next",a.bg),y.classList.add("fade-in"),E=setTimeout(()=>{y.style.setProperty("--auth-visual-bg",a.bg),y.style.setProperty("--auth-visual-bg-next","none"),y.classList.remove("fade-in"),E=null},360)}))}if(h&&(j(h.value),h.addEventListener("change",n=>j(n.target.value))),v&&S&&h&&C){let n=function(){C.classList.remove("select-open"),v.setAttribute("aria-expanded","false")},a=function(){C.classList.add("select-open"),v.setAttribute("aria-expanded","true")};const t=Array.from(S.querySelectorAll(".select-option"));v.addEventListener("click",()=>{C.classList.contains("select-open")?n():a()}),t.forEach(l=>{l.addEventListener("click",()=>{const o=l.getAttribute("data-value");h.value=o,T.textContent=l.textContent,t.forEach(i=>i.setAttribute("aria-selected",String(i===l))),h.dispatchEvent(new Event("change")),n()}),l.addEventListener("keydown",o=>{(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),l.click()),o.key==="Escape"&&(n(),v.focus());const i=t.indexOf(l);o.key==="ArrowDown"&&(o.preventDefault(),(t[i+1]||t[0]).focus()),o.key==="ArrowUp"&&(o.preventDefault(),(t[i-1]||t[t.length-1]).focus())})}),document.addEventListener("click",l=>{C.contains(l.target)||n()});const s=t.find(l=>l.getAttribute("data-value")===h.value)||t[0];s&&(T.textContent=s.textContent,t.forEach(l=>l.setAttribute("aria-selected",String(l===s))))}const M=e("#year");M&&(M.textContent=new Date().getFullYear());const b=e("#loginBtn");if(b){let n=e("#loginError");n||(n=document.createElement("div"),n.id="loginError",n.style.color="#ef4444",n.style.marginTop="8px",n.style.display="none",b.parentNode.insertBefore(n,b)),b.addEventListener("click",async()=>{n.style.display="none",n.textContent="";const a=b.textContent;b.textContent="Signing in...",b.disabled=!0;try{const t=e("#id").value.trim(),s=e("#password").value.trim(),l=e("#role").value;if(!t||!s)throw new Error("Please enter both email and password");const{user:o,session:i,error:m}=await I(t,s);if(m)throw new Error(m);if(o&&i){const p=U(o);console.log(`Login successful for ${o.email} with role: ${p}`);const u={student:"/dashboard/student",teacher:"/dashboard/teacher",finance:"/dashboard/finance",hall:"/dashboard/hall",coach:"/dashboard/coach",lab:"/dashboard/lab"};window.location.href=u[p]||u[l]||"/dashboard/student"}else throw new Error("Login failed - no session created")}catch(t){console.error("Login error:",t),n.textContent=t.message||"Login failed. Please try again.",n.style.display="block"}finally{b.textContent=a,b.disabled=!1}}),["#id","#password"].forEach(a=>{const t=e(a);t&&t.addEventListener("keypress",s=>{s.key==="Enter"&&(s.preventDefault(),b.click())})})}const O=e("#logoutBtn");O&&O.addEventListener("click",async n=>{n.preventDefault();try{await Y(),W(),window.location.href="/login"}catch(a){console.error("Logout error:",a),W(),window.location.href="/login"}}),q((n,a)=>{n==="SIGNED_OUT"&&window.location.pathname!=="/login"&&(window.location.href="/login")});const D=e("#portals");if(D){const n=[{id:"wr",label:"W&R"},{id:"afst",label:"Af. St"},{id:"math",label:"Math"},{id:"cs",label:"CS"},{id:"econ",label:"Econ"}];n.forEach(r=>{const d=document.createElement("a");d.href=`/subject?subject=${encodeURIComponent(r.label)}`,d.className="portal";const c=document.createElement("span");c.textContent=r.label,d.appendChild(c),D.appendChild(d)});const a=[{text:"Clear Math S1 Book",done:!1},{text:"Physics Book",done:!1},{text:"Clear Dues w/ Finance",done:!1}],t=e("#todoList");t&&a.forEach(r=>{const d=document.createElement("div");d.style.display="flex",d.style.justifyContent="space-between",d.style.alignItems="center",d.style.gap="8px",d.innerHTML=`<span>${r.text}</span><span class="badge ${r.done?"badge-success":"badge-warning"}">${r.done?"Done":"Pending"}</span>`,t.appendChild(d)});const s=Math.round(a.filter(r=>r.done).length/a.length*100),l=e("#overallFill"),o=e("#overallPct");l&&o&&(l.style.width=s+"%",o.textContent=s+"%");const i=e("#overallStatus");if(i){const r=s===100;i.textContent=r?"Overall: Approved":"Overall: Pending",i.className="badge "+(r?"badge-success":"badge-warning")}const m=e("#exportBtn");m&&m.addEventListener("click",()=>alert("This will export PDF/CSV/Excel once backend is connected."));const p=e("#subjectSelect"),u=e("#subjectTrigger"),k=e("#subjectTriggerText"),A=e("#subjectMenu"),x=e("#subjectSelectWrap");if(p&&A&&(n.forEach(r=>{const d=document.createElement("option");d.value=r.id,d.textContent=r.label,p.appendChild(d);const c=document.createElement("div");c.className="select-option",c.setAttribute("role","option"),c.setAttribute("data-value",r.id),c.setAttribute("tabindex","0"),c.textContent=r.label,A.appendChild(c)}),u&&x&&k)){let r=function(){x.classList.remove("select-open"),u.setAttribute("aria-expanded","false")},d=function(){x.classList.add("select-open"),u.setAttribute("aria-expanded","true")};const c=Array.from(A.querySelectorAll(".select-option"));u.addEventListener("click",()=>{x.classList.contains("select-open")?r():d()}),c.forEach(g=>{g.addEventListener("click",()=>{const f=g.getAttribute("data-value");p.value=f,k.textContent=g.textContent,c.forEach(w=>w.setAttribute("aria-selected",String(w===g))),r()}),g.addEventListener("keydown",f=>{(f.key==="Enter"||f.key===" ")&&(f.preventDefault(),g.click()),f.key==="Escape"&&(r(),u.focus());const w=c.indexOf(g);f.key==="ArrowDown"&&(f.preventDefault(),(c[w+1]||c[0]).focus()),f.key==="ArrowUp"&&(f.preventDefault(),(c[w-1]||c[c.length-1]).focus())})}),document.addEventListener("click",g=>{x.contains(g.target)||r()}),c.length>0&&(p.value=c[0].getAttribute("data-value"),k.textContent=c[0].textContent,c[0].setAttribute("aria-selected","true"))}e("#uploadBtn")?.addEventListener("click",()=>{const r=e("#itemCode").value.trim(),d=e("#photo").files[0],c=e("#uploadResult");if(!r||!d){c.textContent="Please provide item code and a photo.";return}if(!d.type.startsWith("image/")){c.textContent="Please upload a valid image.";return}c.textContent="Uploaded successfully. Awaiting teacher validation."})}const P=e("#subjectTitle");if(P){const a=new URLSearchParams(location.search).get("subject")||"Subject";P.textContent=a;const t=[{text:`${a} S1 Book`,done:!1},{text:"Return Calculator",done:!0},{text:`${a} P1 Book`,done:!1}],s=Math.round(t.filter(o=>o.done).length/t.length*100);e("#subjectPct").textContent=s+"%",e("#subjectFill").style.width=s+"%";const l=e("#subjectTodo");t.forEach(o=>{const i=document.createElement("div");i.style.display="flex",i.style.justifyContent="space-between",i.style.alignItems="center",i.style.gap="8px",i.innerHTML=`<span>${o.text}</span><span class="badge ${o.done?"badge-success":"badge-warning"}">${o.done?"Completed":"Press to Clear Now"}</span>`,l.appendChild(i)})}const B=e("#teacherTable tbody");if(B){[{class:"Math Y2-A",student:"S12345 • Ama N.",subject:"Mathematics",item:"Textbook MATH-BOOK-12",returned:!1},{class:"Math Y2-A",student:"S12002 • Malik O.",subject:"Mathematics",item:"Workbook MATH-WB-07",returned:!0},{class:"Physics Y1-B",student:"S12811 • Tumi K.",subject:"Physics",item:"Calculator CALC-84",returned:!1}].forEach(t=>{const s=document.createElement("tr");s.innerHTML=`
        <td>${t.class}</td>
        <td>${t.student}</td>
        <td>${t.subject}</td>
        <td>${t.item}</td>
        <td><span class="badge ${t.returned?"badge-success":"badge-warning"}">${t.returned?"Returned":"Not Returned"}</span></td>
        <td>
          <button class="button button-primary">Mark Returned</button>
          <button class="button">Flag Issue</button>
        </td>
      `,B.appendChild(s)});const a=e("#sigPad");if(a){const t=a.getContext("2d");let s=!1,l=null;a.addEventListener("pointerdown",o=>{s=!0,l=[o.offsetX,o.offsetY]}),a.addEventListener("pointerup",()=>{s=!1,l=null}),a.addEventListener("pointermove",o=>{if(!s)return;const[i,m]=l,p=o.offsetX,u=o.offsetY;t.strokeStyle="#e5e7eb",t.lineWidth=2,t.lineCap="round",t.beginPath(),t.moveTo(i,m),t.lineTo(p,u),t.stroke(),l=[p,u]}),e("#clearSig")?.addEventListener("click",()=>{t.clearRect(0,0,a.width,a.height)}),e("#saveSig")?.addEventListener("click",()=>{alert("Signature saved (mock).")})}}const R=e("#financeTable tbody");if(R){const n=[{name:"S12345 • Ama N.",tuition:0,replace:0,status:"Clear"},{name:"S12002 • Malik O.",tuition:300,replace:0,status:"Due"},{name:"S12811 • Tumi K.",tuition:0,replace:45,status:"Due"}],a=t=>t==="Clear"?"badge-success":"badge-danger";n.forEach(t=>{const s=document.createElement("tr");s.innerHTML=`
        <td>${t.name}</td>
        <td>$${t.tuition}</td>
        <td>$${t.replace}</td>
        <td><span class="badge ${a(t.status)}">${t.status}</span></td>
      `,R.appendChild(s)})}const N=e("#hallTable tbody");if(N){const n=[{student:"S12345 • Ama N.",hall:"Kibo",room:"A-203",status:"OK"},{student:"S12002 • Malik O.",hall:"Kibo",room:"A-118",status:"Not OK"}],a=t=>t==="OK"?"badge-success":"badge-danger";n.forEach(t=>{const s=document.createElement("tr");s.innerHTML=`
        <td>${t.student}</td>
        <td>${t.hall}</td>
        <td>${t.room}</td>
        <td><span class="badge ${a(t.status)}">${t.status}</span></td>
        <td>
          <button class="button button-primary">Mark OK</button>
          <button class="button">Mark Not OK</button>
        </td>
      `,N.appendChild(s)})}const K=e("#coachTable tbody");if(K){const n=[{student:"S12345 • Ama N.",sport:"Basketball",item:"Jersey #12",status:"Returned"},{student:"S12811 • Tumi K.",sport:"Soccer",item:"Shin Guards",status:"Lost"}],a=t=>t==="Returned"?"badge-success":"badge-danger";n.forEach(t=>{const s=document.createElement("tr");s.innerHTML=`
        <td>${t.student}</td>
        <td>${t.sport}</td>
        <td>${t.item}</td>
        <td><span class="badge ${a(t.status)}">${t.status}</span></td>
        <td>
          <button class="button button-primary">Mark Returned</button>
          <button class="button">Flag Lost</button>
        </td>
      `,K.appendChild(s)})}const H=e("#labTable tbody");if(H){const n=[{student:"S12345 • Ama N.",subject:"Chemistry",item:"Goggles",cost:0,status:"OK"},{student:"S12002 • Malik O.",subject:"Biology",item:"Lab Manual",cost:15,status:"Cost"}],a=t=>t==="OK"?"badge-success":"badge-warning";n.forEach(t=>{const s=document.createElement("tr");s.innerHTML=`
        <td>${t.student}</td>
        <td>${t.subject}</td>
        <td>${t.item}</td>
        <td>$${t.cost}</td>
        <td><span class="badge ${a(t.status)}">${t.status}</span></td>
        <td>
          <button class="button button-primary">Resolve</button>
        </td>
      `,H.appendChild(s)})}})();
