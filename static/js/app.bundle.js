import{s as O,g as D,a as P,c as M,o as R}from"./auth.bundle.js";(function(){const n=e=>document.querySelector(e),i=n("#role"),u=n("#roleTrigger"),y=n("#roleTriggerText"),v=n("#roleMenu"),b=n("#roleSelectWrap"),h=n("#loginSubtitle"),d=document.querySelector(".auth-visual"),C={student:{subtitle:"African Leadership Academy • Student Clearance Portal",bg:"url('/static/images/students.jpeg')"},teacher:{subtitle:"African Leadership Academy • Teacher Clearance Dashboard",bg:"url('/static/images/teacher.jpeg')"},finance:{subtitle:"African Leadership Academy • Finance Clearance Dashboard",bg:"url('/static/images/finance.jpeg')"},hall:{subtitle:"African Leadership Academy • Hall Clearance Dashboard",bg:"url('/static/images/hall.jpeg')"},coach:{subtitle:"African Leadership Academy • Sports Clearance Dashboard",bg:"url('/static/images/coach.jpeg')"},lab:{subtitle:"African Leadership Academy • Labs Clearance Dashboard",bg:"url('/static/images/lab.jpeg')"}};let g=null;function j(e,a){const t=new Image;t.onload=a,t.src=e.replace(/^url\(['"]?|['"]?\)$/g,"").replace(/^url\('/,"").replace(/'\)$/,"")}function w(e){const a=C[e]||C.student;d&&(g&&(clearTimeout(g),g=null),h&&(h.style.opacity="0",setTimeout(()=>{h.textContent=a.subtitle,h.style.opacity="1"},120)),j(a.bg.replace(/^url\(|\)$/g,"").replace(/['"]/g,""),()=>{d.style.setProperty("--auth-visual-bg-next",a.bg),d.classList.add("fade-in"),g=setTimeout(()=>{d.style.setProperty("--auth-visual-bg",a.bg),d.style.setProperty("--auth-visual-bg-next","none"),d.classList.remove("fade-in"),g=null},360)}))}if(i&&(w(i.value),i.addEventListener("change",e=>w(e.target.value))),u&&v&&i&&b){let e=function(){b.classList.remove("select-open"),u.setAttribute("aria-expanded","false")},a=function(){b.classList.add("select-open"),u.setAttribute("aria-expanded","true")};const t=Array.from(v.querySelectorAll(".select-option"));u.addEventListener("click",()=>{b.classList.contains("select-open")?e():a()}),t.forEach(r=>{r.addEventListener("click",()=>{const o=r.getAttribute("data-value");i.value=o,y.textContent=r.textContent,t.forEach(l=>l.setAttribute("aria-selected",String(l===r))),i.dispatchEvent(new Event("change")),e()}),r.addEventListener("keydown",o=>{(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),r.click()),o.key==="Escape"&&(e(),u.focus());const l=t.indexOf(r);o.key==="ArrowDown"&&(o.preventDefault(),(t[l+1]||t[0]).focus()),o.key==="ArrowUp"&&(o.preventDefault(),(t[l-1]||t[t.length-1]).focus())})}),document.addEventListener("click",r=>{b.contains(r.target)||e()});const s=t.find(r=>r.getAttribute("data-value")===i.value)||t[0];s&&(y.textContent=s.textContent,t.forEach(r=>r.setAttribute("aria-selected",String(r===s))))}const E=n("#year");E&&(E.textContent=new Date().getFullYear());const c=n("#loginBtn");if(c){let e=n("#loginError");e||(e=document.createElement("div"),e.id="loginError",e.style.color="#ef4444",e.style.marginTop="8px",e.style.display="none",c.parentNode.insertBefore(e,c)),c.addEventListener("click",async()=>{e.style.display="none",e.textContent="";const a=c.textContent;c.textContent="Signing in...",c.disabled=!0;try{const t=n("#id").value.trim(),s=n("#password").value.trim(),r=n("#role").value;if(!t||!s)throw new Error("Please enter both email and password");const{user:o,session:l,error:m}=await O(t,s);if(m)throw new Error(m);if(o&&l){const p=D(o);console.log(`Login successful for ${o.email} with role: ${p}`);const f={student:"/dashboard/student",teacher:"/dashboard/teacher",finance:"/dashboard/finance",hall:"/dashboard/hall",coach:"/dashboard/coach",lab:"/dashboard/lab"};window.location.href=f[p]||f[r]||"/dashboard/student"}else throw new Error("Login failed - no session created")}catch(t){console.error("Login error:",t),e.textContent=t.message||"Login failed. Please try again.",e.style.display="block"}finally{c.textContent=a,c.disabled=!1}}),["#id","#password"].forEach(a=>{const t=n(a);t&&t.addEventListener("keypress",s=>{s.key==="Enter"&&(s.preventDefault(),c.click())})})}const L=n("#logoutBtn");L&&L.addEventListener("click",async e=>{e.preventDefault();try{await P(),M(),window.location.href="/login"}catch(a){console.error("Logout error:",a),M(),window.location.href="/login"}}),R((e,a)=>{e==="SIGNED_OUT"&&window.location.pathname!=="/login"&&(window.location.href="/login")});const T=n("#subjectTitle");if(T){const a=new URLSearchParams(location.search).get("subject")||"Subject";T.textContent=a;const t=[{text:`${a} S1 Book`,done:!1},{text:"Return Calculator",done:!0},{text:`${a} P1 Book`,done:!1}],s=Math.round(t.filter(o=>o.done).length/t.length*100);n("#subjectPct").textContent=s+"%",n("#subjectFill").style.width=s+"%";const r=n("#subjectTodo");t.forEach(o=>{const l=document.createElement("div");l.style.display="flex",l.style.justifyContent="space-between",l.style.alignItems="center",l.style.gap="8px",l.innerHTML=`<span>${o.text}</span><span class="badge ${o.done?"badge-success":"badge-warning"}">${o.done?"Completed":"Press to Clear Now"}</span>`,r.appendChild(l)})}const $=n("#teacherTable tbody");if($){[{class:"Math Y2-A",student:"S12345 • Ama N.",subject:"Mathematics",item:"Textbook MATH-BOOK-12",returned:!1},{class:"Math Y2-A",student:"S12002 • Malik O.",subject:"Mathematics",item:"Workbook MATH-WB-07",returned:!0},{class:"Physics Y1-B",student:"S12811 • Tumi K.",subject:"Physics",item:"Calculator CALC-84",returned:!1}].forEach(t=>{const s=document.createElement("tr");s.innerHTML=`
        <td>${t.class}</td>
        <td>${t.student}</td>
        <td>${t.subject}</td>
        <td>${t.item}</td>
        <td><span class="badge ${t.returned?"badge-success":"badge-warning"}">${t.returned?"Returned":"Not Returned"}</span></td>
        <td>
          <button class="button button-primary">Mark Returned</button>
          <button class="button">Flag Issue</button>
        </td>
      `,$.appendChild(s)});const a=n("#sigPad");if(a){const t=a.getContext("2d");let s=!1,r=null;a.addEventListener("pointerdown",o=>{s=!0,r=[o.offsetX,o.offsetY]}),a.addEventListener("pointerup",()=>{s=!1,r=null}),a.addEventListener("pointermove",o=>{if(!s)return;const[l,m]=r,p=o.offsetX,f=o.offsetY;t.strokeStyle="#e5e7eb",t.lineWidth=2,t.lineCap="round",t.beginPath(),t.moveTo(l,m),t.lineTo(p,f),t.stroke(),r=[p,f]}),n("#clearSig")?.addEventListener("click",()=>{t.clearRect(0,0,a.width,a.height)}),n("#saveSig")?.addEventListener("click",()=>{alert("Signature saved (mock).")})}}const k=n("#financeTable tbody");if(k){const e=[{name:"S12345 • Ama N.",tuition:0,replace:0,status:"Clear"},{name:"S12002 • Malik O.",tuition:300,replace:0,status:"Due"},{name:"S12811 • Tumi K.",tuition:0,replace:45,status:"Due"}],a=t=>t==="Clear"?"badge-success":"badge-danger";e.forEach(t=>{const s=document.createElement("tr");s.innerHTML=`
        <td>${t.name}</td>
        <td>$${t.tuition}</td>
        <td>$${t.replace}</td>
        <td><span class="badge ${a(t.status)}">${t.status}</span></td>
      `,k.appendChild(s)})}const A=n("#hallTable tbody");if(A){const e=[{student:"S12345 • Ama N.",hall:"Kibo",room:"A-203",status:"OK"},{student:"S12002 • Malik O.",hall:"Kibo",room:"A-118",status:"Not OK"}],a=t=>t==="OK"?"badge-success":"badge-danger";e.forEach(t=>{const s=document.createElement("tr");s.innerHTML=`
        <td>${t.student}</td>
        <td>${t.hall}</td>
        <td>${t.room}</td>
        <td><span class="badge ${a(t.status)}">${t.status}</span></td>
        <td>
          <button class="button button-primary">Mark OK</button>
          <button class="button">Mark Not OK</button>
        </td>
      `,A.appendChild(s)})}const S=n("#coachTable tbody");if(S){const e=[{student:"S12345 • Ama N.",sport:"Basketball",item:"Jersey #12",status:"Returned"},{student:"S12811 • Tumi K.",sport:"Soccer",item:"Shin Guards",status:"Lost"}],a=t=>t==="Returned"?"badge-success":"badge-danger";e.forEach(t=>{const s=document.createElement("tr");s.innerHTML=`
        <td>${t.student}</td>
        <td>${t.sport}</td>
        <td>${t.item}</td>
        <td><span class="badge ${a(t.status)}">${t.status}</span></td>
        <td>
          <button class="button button-primary">Mark Returned</button>
          <button class="button">Flag Lost</button>
        </td>
      `,S.appendChild(s)})}const x=n("#labTable tbody");if(x){const e=[{student:"S12345 • Ama N.",subject:"Chemistry",item:"Goggles",cost:0,status:"OK"},{student:"S12002 • Malik O.",subject:"Biology",item:"Lab Manual",cost:15,status:"Cost"}],a=t=>t==="OK"?"badge-success":"badge-warning";e.forEach(t=>{const s=document.createElement("tr");s.innerHTML=`
        <td>${t.student}</td>
        <td>${t.subject}</td>
        <td>${t.item}</td>
        <td>$${t.cost}</td>
        <td><span class="badge ${a(t.status)}">${t.status}</span></td>
        <td>
          <button class="button button-primary">Resolve</button>
        </td>
      `,x.appendChild(s)})}})();
