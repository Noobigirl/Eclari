import{s as O,a as D,c as M,o as P}from"./auth.bundle.js";(function(){const n=e=>document.querySelector(e),i=n("#role"),u=n("#roleTrigger"),m=n("#roleTriggerText"),h=n("#roleMenu"),b=n("#roleSelectWrap"),p=n("#loginSubtitle"),d=document.querySelector(".auth-visual"),y={student:{subtitle:"African Leadership Academy • Student Clearance Portal",bg:"url('/static/images/students.jpeg')"},teacher:{subtitle:"African Leadership Academy • Teacher Clearance Dashboard",bg:"url('/static/images/teacher.jpeg')"},finance:{subtitle:"African Leadership Academy • Finance Clearance Dashboard",bg:"url('/static/images/finance.jpeg')"},hall:{subtitle:"African Leadership Academy • Hall Clearance Dashboard",bg:"url('/static/images/hall.jpeg')"},coach:{subtitle:"African Leadership Academy • Sports Clearance Dashboard",bg:"url('/static/images/coach.jpeg')"},lab:{subtitle:"African Leadership Academy • Labs Clearance Dashboard",bg:"url('/static/images/lab.jpeg')"}};let g=null;function j(e,s){const t=new Image;t.onload=s,t.src=e.replace(/^url\(['"]?|['"]?\)$/g,"").replace(/^url\('/,"").replace(/'\)$/,"")}function v(e){const s=y[e]||y.student;d&&(g&&(clearTimeout(g),g=null),p&&(p.style.opacity="0",setTimeout(()=>{p.textContent=s.subtitle,p.style.opacity="1"},120)),j(s.bg.replace(/^url\(|\)$/g,"").replace(/['"]/g,""),()=>{d.style.setProperty("--auth-visual-bg-next",s.bg),d.classList.add("fade-in"),g=setTimeout(()=>{d.style.setProperty("--auth-visual-bg",s.bg),d.style.setProperty("--auth-visual-bg-next","none"),d.classList.remove("fade-in"),g=null},360)}))}if(i&&(v(i.value),i.addEventListener("change",e=>v(e.target.value))),u&&h&&i&&b){let e=function(){b.classList.remove("select-open"),u.setAttribute("aria-expanded","false")},s=function(){b.classList.add("select-open"),u.setAttribute("aria-expanded","true")};const t=Array.from(h.querySelectorAll(".select-option"));u.addEventListener("click",()=>{b.classList.contains("select-open")?e():s()}),t.forEach(r=>{r.addEventListener("click",()=>{const o=r.getAttribute("data-value");i.value=o,m.textContent=r.textContent,t.forEach(l=>l.setAttribute("aria-selected",String(l===r))),i.dispatchEvent(new Event("change")),e()}),r.addEventListener("keydown",o=>{(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),r.click()),o.key==="Escape"&&(e(),u.focus());const l=t.indexOf(r);o.key==="ArrowDown"&&(o.preventDefault(),(t[l+1]||t[0]).focus()),o.key==="ArrowUp"&&(o.preventDefault(),(t[l-1]||t[t.length-1]).focus())})}),document.addEventListener("click",r=>{b.contains(r.target)||e()});const a=t.find(r=>r.getAttribute("data-value")===i.value)||t[0];a&&(m.textContent=a.textContent,t.forEach(r=>r.setAttribute("aria-selected",String(r===a))))}const C=n("#year");C&&(C.textContent=new Date().getFullYear());const c=n("#loginBtn");if(c){let e=n("#loginError");e||(e=document.createElement("div"),e.id="loginError",e.style.color="#ef4444",e.style.marginTop="8px",e.style.display="none",c.parentNode.insertBefore(e,c)),c.addEventListener("click",async()=>{e.style.display="none",e.textContent="";const s=c.textContent;c.textContent="Signing in...",c.disabled=!0;try{const t=n("#id").value.trim(),a=n("#password").value.trim(),r=n("#role").value;if(!t||!a)throw new Error("Please enter both email and password");const{user:o,session:l,error:f}=await O(t,a);if(f)throw new Error(f);if(o&&l)console.log(`Login successful for ${o.email}`),window.location.href="/auto-redirect";else throw new Error("Login failed - no session created")}catch(t){console.error("Login error:",t),e.textContent=t.message||"Login failed. Please try again.",e.style.display="block"}finally{c.textContent=s,c.disabled=!1}}),["#id","#password"].forEach(s=>{const t=n(s);t&&t.addEventListener("keypress",a=>{a.key==="Enter"&&(a.preventDefault(),c.click())})})}const E=n("#logoutBtn");E&&E.addEventListener("click",async e=>{e.preventDefault();try{await D(),M(),window.location.href="/login"}catch(s){console.error("Logout error:",s),M(),window.location.href="/login"}}),P((e,s)=>{e==="SIGNED_OUT"&&window.location.pathname!=="/login"&&(window.location.href="/login")});const w=n("#subjectTitle");if(w){const s=new URLSearchParams(location.search).get("subject")||"Subject";w.textContent=s;const t=[{text:`${s} S1 Book`,done:!1},{text:"Return Calculator",done:!0},{text:`${s} P1 Book`,done:!1}],a=Math.round(t.filter(o=>o.done).length/t.length*100);n("#subjectPct").textContent=a+"%",n("#subjectFill").style.width=a+"%";const r=n("#subjectTodo");t.forEach(o=>{const l=document.createElement("div");l.style.display="flex",l.style.justifyContent="space-between",l.style.alignItems="center",l.style.gap="8px",l.innerHTML=`<span>${o.text}</span><span class="badge ${o.done?"badge-success":"badge-warning"}">${o.done?"Completed":"Press to Clear Now"}</span>`,r.appendChild(l)})}const L=n("#teacherTable tbody");if(L){[{class:"Math Y2-A",student:"S12345 • Ama N.",subject:"Mathematics",item:"Textbook MATH-BOOK-12",returned:!1},{class:"Math Y2-A",student:"S12002 • Malik O.",subject:"Mathematics",item:"Workbook MATH-WB-07",returned:!0},{class:"Physics Y1-B",student:"S12811 • Tumi K.",subject:"Physics",item:"Calculator CALC-84",returned:!1}].forEach(t=>{const a=document.createElement("tr");a.innerHTML=`
        <td>${t.class}</td>
        <td>${t.student}</td>
        <td>${t.subject}</td>
        <td>${t.item}</td>
        <td><span class="badge ${t.returned?"badge-success":"badge-warning"}">${t.returned?"Returned":"Not Returned"}</span></td>
        <td>
          <button class="button button-primary">Mark Returned</button>
          <button class="button">Flag Issue</button>
        </td>
      `,L.appendChild(a)});const s=n("#sigPad");if(s){const t=s.getContext("2d");let a=!1,r=null;s.addEventListener("pointerdown",o=>{a=!0,r=[o.offsetX,o.offsetY]}),s.addEventListener("pointerup",()=>{a=!1,r=null}),s.addEventListener("pointermove",o=>{if(!a)return;const[l,f]=r,S=o.offsetX,x=o.offsetY;t.strokeStyle="#e5e7eb",t.lineWidth=2,t.lineCap="round",t.beginPath(),t.moveTo(l,f),t.lineTo(S,x),t.stroke(),r=[S,x]}),n("#clearSig")?.addEventListener("click",()=>{t.clearRect(0,0,s.width,s.height)}),n("#saveSig")?.addEventListener("click",()=>{alert("Signature saved (mock).")})}}const T=n("#financeTable tbody");if(T){const e=[{name:"S12345 • Ama N.",tuition:0,replace:0,status:"Clear"},{name:"S12002 • Malik O.",tuition:300,replace:0,status:"Due"},{name:"S12811 • Tumi K.",tuition:0,replace:45,status:"Due"}],s=t=>t==="Clear"?"badge-success":"badge-danger";e.forEach(t=>{const a=document.createElement("tr");a.innerHTML=`
        <td>${t.name}</td>
        <td>$${t.tuition}</td>
        <td>$${t.replace}</td>
        <td><span class="badge ${s(t.status)}">${t.status}</span></td>
      `,T.appendChild(a)})}const $=n("#hallTable tbody");if($){const e=[{student:"S12345 • Ama N.",hall:"Kibo",room:"A-203",status:"OK"},{student:"S12002 • Malik O.",hall:"Kibo",room:"A-118",status:"Not OK"}],s=t=>t==="OK"?"badge-success":"badge-danger";e.forEach(t=>{const a=document.createElement("tr");a.innerHTML=`
        <td>${t.student}</td>
        <td>${t.hall}</td>
        <td>${t.room}</td>
        <td><span class="badge ${s(t.status)}">${t.status}</span></td>
        <td>
          <button class="button button-primary">Mark OK</button>
          <button class="button">Mark Not OK</button>
        </td>
      `,$.appendChild(a)})}const k=n("#coachTable tbody");if(k){const e=[{student:"S12345 • Ama N.",sport:"Basketball",item:"Jersey #12",status:"Returned"},{student:"S12811 • Tumi K.",sport:"Soccer",item:"Shin Guards",status:"Lost"}],s=t=>t==="Returned"?"badge-success":"badge-danger";e.forEach(t=>{const a=document.createElement("tr");a.innerHTML=`
        <td>${t.student}</td>
        <td>${t.sport}</td>
        <td>${t.item}</td>
        <td><span class="badge ${s(t.status)}">${t.status}</span></td>
        <td>
          <button class="button button-primary">Mark Returned</button>
          <button class="button">Flag Lost</button>
        </td>
      `,k.appendChild(a)})}const A=n("#labTable tbody");if(A){const e=[{student:"S12345 • Ama N.",subject:"Chemistry",item:"Goggles",cost:0,status:"OK"},{student:"S12002 • Malik O.",subject:"Biology",item:"Lab Manual",cost:15,status:"Cost"}],s=t=>t==="OK"?"badge-success":"badge-warning";e.forEach(t=>{const a=document.createElement("tr");a.innerHTML=`
        <td>${t.student}</td>
        <td>${t.subject}</td>
        <td>${t.item}</td>
        <td>$${t.cost}</td>
        <td><span class="badge ${s(t.status)}">${t.status}</span></td>
        <td>
          <button class="button button-primary">Resolve</button>
        </td>
      `,A.appendChild(a)})}})();
